{"version":3,"sources":["../src/index.js"],"names":["genActions","require","bindContext","methods","context","target","store","$axios","result","key","bind","createAsyncDataFunction","component","originalAsyncData","data","mixins","idx","mixin","asyncData","r","Object","assign","apply","createFetchFunction","originalFetch","fetch","mergeMethods","forEach","nuxtend","actions","act","funcs","name","module","exports","com"],"mappings":"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","file":"index.js","sourcesContent":["const genActions = require('./genactions')\n\nfunction bindContext (methods, context) {\n  const target = {'$store': context.store, '$axios': context.$axios}\n  const result = {}\n  for (let key in methods) {\n    result[key] = methods[key].bind(target)\n  }\n  return result\n}\n\nfunction createAsyncDataFunction (component, originalAsyncData, methods) {\n  return async (context) => {\n    let data = {}\n    for (let idx in component.mixins) {\n      let mixin = component.mixins[idx]\n      if (typeof mixin.asyncData !== 'undefined') {\n        let r = await mixin.asyncData(context)\n        Object.assign(data, r)\n      }\n    }\n    let target = {}\n    Object.assign(target, bindContext(methods, context))\n    let r = await originalAsyncData.apply(target, [context])\n    Object.assign(data, r)\n    return data\n  }\n}\n\nfunction createFetchFunction (component, originalFetch, methods) {\n  return async (context) => {\n    for (let idx in component.mixins) {\n      let mixin = component.mixins[idx]\n      if (typeof mixin.fetch !== 'undefined') {\n        await mixin.fetch(context)\n      }\n    }\n    let target = {}\n    Object.assign(target, bindContext(methods, context))\n    await originalFetch.apply(target, [context])\n  }\n}\n\nfunction mergeMethods (component) {\n  let methods = {}\n  if (component.mixins) {\n    component.mixins.forEach(mixin => {\n      if (mixin.methods) {\n        Object.assign(methods, mixin.methods)\n      }\n    })\n  }\n  if (component.methods) {\n    Object.assign(methods, component.methods)\n  }\n  if (component.nuxtend && component.nuxtend.actions) {\n    for (let act of component.nuxtend.actions) {\n      const funcs = genActions({}, act)\n      for (let name in funcs) {\n        if (typeof methods[name] === 'undefined') {\n          methods[name] = funcs[name]\n        }\n      }\n    }\n  }\n  return methods\n}\n\nmodule.exports = function (component) {\n  let com = Object.assign(component)\n  let {asyncData, fetch} = com\n  const methods = mergeMethods(com)\n  if (fetch) {\n    com.fetch = createFetchFunction(com, fetch, methods)\n  }\n  if (asyncData) {\n    com.asyncData = createAsyncDataFunction(com, asyncData, methods)\n  }\n  com.methods = methods\n  return com\n}\n\n"]}